# （株）よつや外商部 商品管理・見積アプリ

日本酒の商品リストを管理、閲覧、検索し、顧客向けの見積書PDFを作成するためのWebアプリケーションです。

## 概要

このアプリは、Python製の軽量Webサーバー上で動作し、JSONファイル（`sake_list.json`）をデータベースとして使用します。
ユーザー向けの「商品検索・見積作成画面」と、管理者向けの「データ編集・画像登録画面」を備えています。

## システム構成

*   **フロントエンド**: HTML5, CSS3, Vanilla JavaScript
*   **バックエンド**: Python 3 (`http.server` を拡張)
*   **データストア**: JSONファイル (`sake_list.json`)
*   **PDF生成**: `jspdf`, `html2canvas` (クライアントサイド生成)
*   **画像保存**: `image/` ディレクトリへのファイル保存

## 機能一覧

### 1. ユーザー画面 (`index.html`)

*   **商品一覧表示**: `sake_list.json` のデータをカード形式で表示。
*   **高度な検索**:
    *   **キーワード検索**: 商品名、蔵元、JANコード（スペース無視）での部分一致検索。
    *   **産地フィルタ**: 「東北」「関東」などの**地方区分**でグルーピングされたリストから選択可能。「○○全域」による地方一括検索も対応。
    *   **価格帯フィルタ**: 税抜価格の下限・上限指定。
*   **見積書PDF作成**:
    *   チェックボックスで商品を選択し、「選択商品の見積PDF出力」ボタンでPDFを生成。
    *   宛名（「〇〇御中」）の入力が可能。
    *   1ページあたり10商品の固定レイアウトで、きれいに印刷可能。
*   **全リスト印刷**: 検索結果に関わらず、全商品をリスト化したPDFを出力可能。

### 2. 管理画面 (`admin.html`)

*   **商品データ管理 (CRUD)**:
    *   商品の新規登録、編集、削除。
    *   「公開/非表示」のフラグ設定（季節商品の一時非表示などに利用）。
*   **画像登録機能**:
    *   **画像URLアップロード**: ネット上の画像URLを入力し、サーバー側に自動ダウンロード・保存する機能。
    *   **Google画像検索**: ボタン一つで商品名＋蔵元でGoogle画像検索を開く補助機能。
    *   SSL証明書エラー（`CERTIFICATE_VERIFY_FAILED`）を回避するロジックを実装済み。

### 3. APIサーバー (`server.py`)

*   `POST /api/save`: 管理画面からのJSONデータ保存リクエストを処理。
*   `POST /api/upload_image_url`: 画像URLを受け取り、サーバーローカルに保存する。

## 運用ルールと仕様

### データファイル (`sake_list.json`)
マスターデータとなるJSONファイルです。以下のフィールドが主要な項目です。
*   `商品名`: 必須。
*   `蔵元`: 必須。
*   `産地`: 都道府県名（例: "秋田", "新潟"）。※「県」はつけないのが慣例。
*   `720mL500mLJAN`: **主に使用されるJANコード**。画像ファイル名と紐付きます。
*   `1800mL　JAN`: 1800ml用のJANコード。
*   `isHidden`: `true` の場合、ユーザー画面には表示されません。
*   **JANコードのルール**:
    *   常に **13桁の文字列**（`""`で囲む）として扱います。
    *   13桁未満（7桁や8桁）の場合は、先頭に `0` を埋めて13桁にします（例: `1234567` → `"0000001234567"`）。

### 画像ファイル (`image/`)
*   **命名規則**: `[JANコード].[拡張子]` (例: `4947965003676.jpg`)
*   **優先順位**:
    1.  `720mL500mLJAN` のコードが最優先で使用されます。
    2.  画像が見つからない場合、`1800mL　JAN` での検索は現状行わず、プレースホルダーが表示されます。
*   **対応拡張子**: `.jpg`, `.jpeg`, `.png`, `.gif`, `.webp` (アプリ側で自動判別)

### 産地区分 (リージョン定義)
検索時には以下のリージョン定義に基づいて都道府県がグループ化されます（`js/main.js` 内 `REGIONS` 定数）。

| 地方名 | 含まれる都道府県 |
| :--- | :--- |
| **北海道** | 北海道 |
| **東北** | 青森, 岩手, 宮城, 秋田, 山形, 福島 |
| **関東** | 茨城, 栃木, 群馬, 埼玉, 千葉, 東京, 神奈川 |
| **甲信越・北陸** | 新潟, 富山, 石川, 福井, 山梨, 長野 |
| **東海** | 岐阜, 静岡, 愛知, 三重 |
| **近畿** | 滋賀, 京都, 大阪, 兵庫, 奈良, 和歌山 |
| **中国** | 鳥取, 島根, 岡山, 広島, 山口 |
| **四国** | 徳島, 香川, 愛媛, 高知 |
| **九州・沖縄** | 福岡, 佐賀, 長崎, 熊本, 大分, 宮崎, 鹿児島, 沖縄 |

## 環境構築・起動方法

### 前提条件
*   Python 3.x がインストールされていること。

### 起動コマンド
プロジェクトのルートディレクトリで以下のコマンドを実行します。

```bash
python3 server.py
```

### アクセスURL
*   ユーザー画面: [http://localhost:8080](http://localhost:8080)
*   管理画面: [http://localhost:8080/admin.html](http://localhost:8080/admin.html)

## トラブルシューティング
*   **画像が表示されない**: JANコードが正しいか、`image/` フォルダにファイルが存在するか確認してください。拡張子が `.png` なのにコードで `.jpg` を要求している場合などは自動でフォールバックしますが、極力 `.jpg` 推奨です。
*   **保存できない**: サーバーが起動しているか確認してください。また、`sake_list.json` の書き込み権限を確認してください。
